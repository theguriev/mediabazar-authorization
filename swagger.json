{
  "openapi": "3.0.3",
  "info": {
    "title": "mediabazar-authorization API",
    "description": "Authentication and user management API for mediabazar-authorization application",
    "version": "1.0.0",
    "contact": {
      "name": "mediabazar-authorization Team"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    }
  ],
  "paths": {
    "/": {
      "get": {
        "summary": "Get current user profile",
        "description": "Retrieves the profile of the currently authenticated user",
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User profile retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing access token"
          },
          "409": {
            "description": "User not exists"
          }
        }
      }
    },
    "/login": {
      "post": {
        "summary": "User login",
        "description": "Authenticate user with email and password, returns user data and sets authentication cookies",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "password"],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "User's email address"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 8,
                    "maxLength": 20,
                    "description": "User's password"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "headers": {
              "Set-Cookie": {
                "description": "Authentication cookies (accessToken, refreshToken)",
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid email or password format"
          },
          "403": {
            "description": "Forbidden - Wrong password or email"
          }
        }
      }
    },
    "/registration": {
      "post": {
        "summary": "User registration",
        "description": "Register a new user account with email, password and optional metadata",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "password", "confirmation"],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "User's email address"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 8,
                    "maxLength": 20,
                    "description": "User's password"
                  },
                  "confirmation": {
                    "type": "string",
                    "minLength": 8,
                    "maxLength": 20,
                    "description": "Password confirmation (must match password)"
                  },
                  "meta": {
                    "type": "object",
                    "additionalProperties": true,
                    "description": "Optional user metadata"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Registration successful",
            "headers": {
              "Set-Cookie": {
                "description": "Authentication cookies (accessToken, refreshToken)",
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid data or passwords do not match"
          },
          "409": {
            "description": "Conflict - User already exists"
          }
        }
      }
    },
    "/logout": {
      "post": {
        "summary": "User logout",
        "description": "Logout user, clear authentication cookies and delete refresh tokens",
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Logout successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "deletedCount": {
                      "type": "number",
                      "description": "Number of deleted tokens"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing access token"
          }
        }
      }
    },
    "/refresh": {
      "post": {
        "summary": "Refresh authentication tokens",
        "description": "Refresh access and refresh tokens using existing refresh token",
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Tokens refreshed successfully",
            "headers": {
              "Set-Cookie": {
                "description": "New authentication cookies (accessToken, refreshToken)",
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "404": {
            "description": "Refresh token not found or user not found"
          }
        }
      }
    },
    "/forgot-password": {
      "post": {
        "summary": "Initiate password reset",
        "description": "Generate password reset token for user email",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email"],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "User's email address"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password reset token generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean",
                      "example": true
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid email format"
          },
          "404": {
            "description": "User not found"
          }
        }
      }
    },
    "/update-meta": {
      "put": {
        "summary": "Update user metadata",
        "description": "Update the metadata of the currently authenticated user",
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "meta": {
                    "type": "object",
                    "additionalProperties": true,
                    "description": "User metadata to update"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User metadata updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing access token"
          },
          "409": {
            "description": "User not exists"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "User's unique identifier"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "User's email address"
          },
          "role": {
            "type": "string",
            "default": "user",
            "description": "User's role in the system"
          },
          "meta": {
            "type": "object",
            "additionalProperties": true,
            "description": "User's metadata"
          },
          "forgotPassword": {
            "type": "object",
            "properties": {
              "token": {
                "type": "string",
                "description": "Password reset token"
              },
              "timestamp": {
                "type": "number",
                "description": "Timestamp when reset token was generated"
              }
            }
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Account creation timestamp"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Last update timestamp"
          }
        }
      },
      "Token": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "Token's unique identifier"
          },
          "token": {
            "type": "string",
            "description": "JWT token value"
          },
          "userId": {
            "type": "string",
            "description": "Associated user ID"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Token creation timestamp"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Token last update timestamp"
          }
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "statusCode": {
            "type": "number",
            "description": "HTTP status code"
          },
          "statusMessage": {
            "type": "string",
            "description": "Error message"
          }
        }
      }
    },
    "securitySchemes": {
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "accessToken",
        "description": "Authentication via HTTP-only cookies. The API uses two cookies: `accessToken` for API access and `refreshToken` for token refresh."
      }
    }
  },
  "security": [
    {
      "cookieAuth": []
    }
  ],
  "tags": [
    {
      "name": "Authentication",
      "description": "User authentication and session management"
    },
    {
      "name": "User Management",
      "description": "User profile and metadata management"
    }
  ]
}
